{"version":3,"sources":["upload.server.routes.js"],"names":[],"mappings":";;AAAA,IAAI,SAAU,QAAQ,QAAR,CAAd;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;;AAEA,IAAI,gBAAgB,+BAApB;AACA,IAAI,SAAS,OAAO,EAAE,WAAS,aAAX,EAAP,CAAb;;AAEA,OAAO,OAAP,GAAiB,UAAS,GAAT,EAAc;AAC3B,QAAI,mBAAmB,QAAQ,yCAAR,CAAvB;AACA;;AAEA,QAAI,GAAJ,CAAQ,GAAR,EAAa,iBAAiB,MAA9B;;AAGA,QAAI,IAAJ,CAAS,GAAT,EAAc,OAAO,GAAP,EAAd,EAA4B,UAAU,GAAV,EAAe,GAAf,EAAoB,IAApB,EAA0B;;AAElD,YAAI,SAAS,IAAI,QAAjB;AACA,gBAAQ,GAAR,CAAY,MAAZ;AACA,wBAAgB,MAAhB;AACA,aAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,IAAI,KAAJ,CAAU,MAA9B,EAAsC,GAAtC,EAA2C;AACvC;AACA;AACA;AACA,gBAAI,UAAa,aAAH,SAAoB,MAApB,SAAiC,IAAI,KAAJ,CAAU,CAAV,EAAa,YAA5D;AACA;AACA,eAAG,MAAH,CAAU,IAAI,KAAJ,CAAU,CAAV,EAAa,IAAvB,EAA6B,OAA7B,EAAsC,UAAS,GAAT,EAAc;AAChD,oBAAI,GAAJ,EAAS;AACL,0BAAM,GAAN;AACH;AACD,wBAAQ,GAAR;AACH,aALD;AAMH;AACJ,KAlBD;AAsBH,CA7BD;;AA+BA,IAAI,kBAAkB,SAAlB,eAAkB,CAAS,MAAT,EAAiB;AACnC,QAAI,CAAC,GAAG,UAAH,CAAiB,aAAjB,SAAkC,MAAlC,CAAL,EAAkD;AAC9C,WAAG,KAAH,CAAY,aAAZ,SAA6B,MAA7B,EAAuC,UAAS,GAAT,EAAc;AACjD,gBAAI,GAAJ,EAAS;AACL,sBAAM,GAAN;AACH;AACD,oBAAQ,GAAR,iBAA0B,MAA1B;AACH,SALD;AAMH;AAEJ,CAVD;AAWA;AACA;AACA;AACA;AACA","file":"upload.server.routes-compiled.js","sourcesContent":["var multer  = require('multer');\nvar fs = require('fs');\n\nvar uploadCppPath = \"userUploadFiles/userUploadCpp\";\nvar upload = multer({ dest: `${uploadCppPath}`});\n\nmodule.exports = function(app) {\n    var uploadController = require('../controllers/upload.server.controller');\n    //app.get('/', uploadFileController.render);\n\n    app.get('/', uploadController.render);\n\n\n    app.post('/', upload.any(), function (req, res, next) {\n\n        var userIP = req.hostname;\n        console.log(userIP);\n        makeUserSpecDir(userIP);\n        for (var i = 0; i < req.files.length; i++) {\n            // 图片会放在uploads目录并且没有后缀，需要自己转存，用到fs模块\n            // 转存，fs.rename(oldPath, newPath,callback);\n            //console.log(req.files[i]);\n            var newPath = `${uploadCppPath}/${userIP}/`  + req.files[i].originalname;\n            //console.log(newPath);\n            fs.rename(req.files[i].path, newPath, function(err) {\n                if (err) {\n                    throw err;\n                }\n                console.log(`rename file done!`);\n            })\n        }\n    })\n\n\n\n};\n\nvar makeUserSpecDir = function(userIP) {\n    if (!fs.existsSync(`${uploadCppPath}/${userIP}`)) {\n        fs.mkdir(`${uploadCppPath}/${userIP}`, function(err) {\n            if (err) {\n                throw err;\n            }\n            console.log(`mkdir for /${userIP} success!`);\n        })\n    }\n\n}\n//\n// var initMulter(req) {\n//     var instance = multer({ dest: 'cppFiles/' })\n//     return instance\n// }"]}