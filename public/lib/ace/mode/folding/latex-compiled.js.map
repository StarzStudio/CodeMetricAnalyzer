{"version":3,"sources":["latex.js"],"names":[],"mappings":"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","file":"latex-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2012, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\n\nvar oop = require(\"../../lib/oop\");\nvar BaseFoldMode = require(\"./fold_mode\").FoldMode;\nvar Range = require(\"../../range\").Range;\nvar TokenIterator = require(\"../../token_iterator\").TokenIterator;\n\nvar FoldMode = exports.FoldMode = function() {};\n\noop.inherits(FoldMode, BaseFoldMode);\n\n(function() {\n\n    this.foldingStartMarker = /^\\s*\\\\(begin)|(section|subsection|paragraph)\\b|{\\s*$/;\n    this.foldingStopMarker = /^\\s*\\\\(end)\\b|^\\s*}/;\n\n    this.getFoldWidgetRange = function(session, foldStyle, row) {\n        var line = session.doc.getLine(row);\n        var match = this.foldingStartMarker.exec(line);\n        if (match) {\n            if (match[1])\n                return this.latexBlock(session, row, match[0].length - 1);\n            if (match[2])\n                return this.latexSection(session, row, match[0].length - 1);\n\n            return this.openingBracketBlock(session, \"{\", row, match.index);\n        }\n\n        var match = this.foldingStopMarker.exec(line);\n        if (match) {\n            if (match[1])\n                return this.latexBlock(session, row, match[0].length - 1);\n\n            return this.closingBracketBlock(session, \"}\", row, match.index + match[0].length);\n        }\n    };\n\n    this.latexBlock = function(session, row, column) {\n        var keywords = {\n            \"\\\\begin\": 1,\n            \"\\\\end\": -1\n        };\n\n        var stream = new TokenIterator(session, row, column);\n        var token = stream.getCurrentToken();\n        if (!token || !(token.type == \"storage.type\" || token.type == \"constant.character.escape\"))\n            return;\n\n        var val = token.value;\n        var dir = keywords[val];\n\n        var getType = function() {\n            var token = stream.stepForward();\n            var type = token.type == \"lparen\" ?stream.stepForward().value : \"\";\n            if (dir === -1) {\n                stream.stepBackward();\n                if (type)\n                    stream.stepBackward();\n            }\n            return type;\n        };\n        var stack = [getType()];\n        var startColumn = dir === -1 ? stream.getCurrentTokenColumn() : session.getLine(row).length;\n        var startRow = row;\n\n        stream.step = dir === -1 ? stream.stepBackward : stream.stepForward;\n        while(token = stream.step()) {\n            if (!token || !(token.type == \"storage.type\" || token.type == \"constant.character.escape\"))\n                continue;\n            var level = keywords[token.value];\n            if (!level)\n                continue;\n            var type = getType();\n            if (level === dir)\n                stack.unshift(type);\n            else if (stack.shift() !== type || !stack.length)\n                break;\n        }\n\n        if (stack.length)\n            return;\n\n        var row = stream.getCurrentTokenRow();\n        if (dir === -1)\n            return new Range(row, session.getLine(row).length, startRow, startColumn);\n        stream.stepBackward();\n        return new Range(startRow, startColumn, row, stream.getCurrentTokenColumn());\n    };\n\n    this.latexSection = function(session, row, column) {\n        var keywords = [\"\\\\subsection\", \"\\\\section\", \"\\\\begin\", \"\\\\end\", \"\\\\paragraph\"];\n\n        var stream = new TokenIterator(session, row, column);\n        var token = stream.getCurrentToken();\n        if (!token || token.type != \"storage.type\")\n            return;\n\n        var startLevel = keywords.indexOf(token.value);\n        var stackDepth = 0\n        var endRow = row;\n\n        while(token = stream.stepForward()) {\n            if (token.type !== \"storage.type\")\n                continue;\n            var level = keywords.indexOf(token.value);\n\n            if (level >= 2) {\n                if (!stackDepth)\n                    endRow = stream.getCurrentTokenRow() - 1;\n                stackDepth += level == 2 ? 1 : - 1;\n                if (stackDepth < 0)\n                    break\n            } else if (level >= startLevel)\n                break;\n        }\n\n        if (!stackDepth)\n            endRow = stream.getCurrentTokenRow() - 1;\n\n        while (endRow > row && !/\\S/.test(session.getLine(endRow)))\n            endRow--;\n\n        return new Range(\n            row, session.getLine(row).length,\n            endRow, session.getLine(endRow).length\n        );\n    };\n\n}).call(FoldMode.prototype);\n\n});\n"]}