{"version":3,"sources":["xml.js"],"names":[],"mappings":"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","file":"xml-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2010, Ajax.org B.V.\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\n\nvar oop = require(\"../../lib/oop\");\nvar lang = require(\"../../lib/lang\");\nvar Range = require(\"../../range\").Range;\nvar BaseFoldMode = require(\"./fold_mode\").FoldMode;\nvar TokenIterator = require(\"../../token_iterator\").TokenIterator;\n\nvar FoldMode = exports.FoldMode = function(voidElements, optionalEndTags) {\n    BaseFoldMode.call(this);\n    this.voidElements = voidElements || {};\n    this.optionalEndTags = oop.mixin({}, this.voidElements);\n    if (optionalEndTags)\n        oop.mixin(this.optionalEndTags, optionalEndTags);\n    \n};\noop.inherits(FoldMode, BaseFoldMode);\n\nvar Tag = function() {\n    this.tagName = \"\";\n    this.closing = false;\n    this.selfClosing = false;\n    this.start = {row: 0, column: 0};\n    this.end = {row: 0, column: 0};\n};\n\nfunction is(token, type) {\n    return token.type.lastIndexOf(type + \".xml\") > -1;\n}\n\n(function() {\n\n    this.getFoldWidget = function(session, foldStyle, row) {\n        var tag = this._getFirstTagInLine(session, row);\n\n        if (!tag)\n            return this.getCommentFoldWidget(session, row);\n\n        if (tag.closing || (!tag.tagName && tag.selfClosing))\n            return foldStyle == \"markbeginend\" ? \"end\" : \"\";\n\n        if (!tag.tagName || tag.selfClosing || this.voidElements.hasOwnProperty(tag.tagName.toLowerCase()))\n            return \"\";\n\n        if (this._findEndTagInLine(session, row, tag.tagName, tag.end.column))\n            return \"\";\n\n        return \"start\";\n    };\n    \n    this.getCommentFoldWidget = function(session, row) {\n        if (/comment/.test(session.getState(row)) && /<!-/.test(session.getLine(row)))\n            return \"start\";\n        return \"\";\n    }\n\n    /*\n     * returns a first tag (or a fragment) in a line\n     */\n    this._getFirstTagInLine = function(session, row) {\n        var tokens = session.getTokens(row);\n        var tag = new Tag();\n\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            if (is(token, \"tag-open\")) {\n                tag.end.column = tag.start.column + token.value.length;\n                tag.closing = is(token, \"end-tag-open\");\n                token = tokens[++i];\n                if (!token)\n                    return null;\n                tag.tagName = token.value;\n                tag.end.column += token.value.length;\n                for (i++; i < tokens.length; i++) {\n                    token = tokens[i];\n                    tag.end.column += token.value.length;\n                    if (is(token, \"tag-close\")) {\n                        tag.selfClosing = token.value == '/>';\n                        break;\n                    }\n                }\n                return tag;\n            } else if (is(token, \"tag-close\")) {\n                tag.selfClosing = token.value == '/>';\n                return tag;\n            }\n            tag.start.column += token.value.length;\n        }\n\n        return null;\n    };\n\n    this._findEndTagInLine = function(session, row, tagName, startColumn) {\n        var tokens = session.getTokens(row);\n        var column = 0;\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            column += token.value.length;\n            if (column < startColumn)\n                continue;\n            if (is(token, \"end-tag-open\")) {\n                token = tokens[i + 1];\n                if (token && token.value == tagName)\n                    return true;\n            }\n        }\n        return false;\n    };\n\n    /*\n     * reads a full tag and places the iterator after the tag\n     */\n    this._readTagForward = function(iterator) {\n        var token = iterator.getCurrentToken();\n        if (!token)\n            return null;\n\n        var tag = new Tag();\n        do {\n            if (is(token, \"tag-open\")) {\n                tag.closing = is(token, \"end-tag-open\");\n                tag.start.row = iterator.getCurrentTokenRow();\n                tag.start.column = iterator.getCurrentTokenColumn();\n            } else if (is(token, \"tag-name\")) {\n                tag.tagName = token.value;\n            } else if (is(token, \"tag-close\")) {\n                tag.selfClosing = token.value == \"/>\";\n                tag.end.row = iterator.getCurrentTokenRow();\n                tag.end.column = iterator.getCurrentTokenColumn() + token.value.length;\n                iterator.stepForward();\n                return tag;\n            }\n        } while(token = iterator.stepForward());\n\n        return null;\n    };\n    \n    this._readTagBackward = function(iterator) {\n        var token = iterator.getCurrentToken();\n        if (!token)\n            return null;\n\n        var tag = new Tag();\n        do {\n            if (is(token, \"tag-open\")) {\n                tag.closing = is(token, \"end-tag-open\");\n                tag.start.row = iterator.getCurrentTokenRow();\n                tag.start.column = iterator.getCurrentTokenColumn();\n                iterator.stepBackward();\n                return tag;\n            } else if (is(token, \"tag-name\")) {\n                tag.tagName = token.value;\n            } else if (is(token, \"tag-close\")) {\n                tag.selfClosing = token.value == \"/>\";\n                tag.end.row = iterator.getCurrentTokenRow();\n                tag.end.column = iterator.getCurrentTokenColumn() + token.value.length;\n            }\n        } while(token = iterator.stepBackward());\n\n        return null;\n    };\n    \n    this._pop = function(stack, tag) {\n        while (stack.length) {\n            \n            var top = stack[stack.length-1];\n            if (!tag || top.tagName == tag.tagName) {\n                return stack.pop();\n            }\n            else if (this.optionalEndTags.hasOwnProperty(top.tagName)) {\n                stack.pop();\n                continue;\n            } else {\n                return null;\n            }\n        }\n    };\n    \n    this.getFoldWidgetRange = function(session, foldStyle, row) {\n        var firstTag = this._getFirstTagInLine(session, row);\n        \n        if (!firstTag) {\n            return this.getCommentFoldWidget(session, row)\n                && session.getCommentFoldRange(row, session.getLine(row).length);\n        }\n        \n        var isBackward = firstTag.closing || firstTag.selfClosing;\n        var stack = [];\n        var tag;\n        \n        if (!isBackward) {\n            var iterator = new TokenIterator(session, row, firstTag.start.column);\n            var start = {\n                row: row,\n                column: firstTag.start.column + firstTag.tagName.length + 2\n            };\n            if (firstTag.start.row == firstTag.end.row)\n                start.column = firstTag.end.column;\n            while (tag = this._readTagForward(iterator)) {\n                if (tag.selfClosing) {\n                    if (!stack.length) {\n                        tag.start.column += tag.tagName.length + 2;\n                        tag.end.column -= 2;\n                        return Range.fromPoints(tag.start, tag.end);\n                    } else\n                        continue;\n                }\n                \n                if (tag.closing) {\n                    this._pop(stack, tag);\n                    if (stack.length == 0)\n                        return Range.fromPoints(start, tag.start);\n                }\n                else {\n                    stack.push(tag);\n                }\n            }\n        }\n        else {\n            var iterator = new TokenIterator(session, row, firstTag.end.column);\n            var end = {\n                row: row,\n                column: firstTag.start.column\n            };\n            \n            while (tag = this._readTagBackward(iterator)) {\n                if (tag.selfClosing) {\n                    if (!stack.length) {\n                        tag.start.column += tag.tagName.length + 2;\n                        tag.end.column -= 2;\n                        return Range.fromPoints(tag.start, tag.end);\n                    } else\n                        continue;\n                }\n                \n                if (!tag.closing) {\n                    this._pop(stack, tag);\n                    if (stack.length == 0) {\n                        tag.start.column += tag.tagName.length + 2;\n                        if (tag.start.row == tag.end.row && tag.start.column < tag.end.column)\n                            tag.start.column = tag.end.column;\n                        return Range.fromPoints(tag.start, end);\n                    }\n                }\n                else {\n                    stack.push(tag);\n                }\n            }\n        }\n        \n    };\n\n}).call(FoldMode.prototype);\n\n});\n"]}