{"version":3,"sources":["lua.js"],"names":[],"mappings":"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","file":"lua-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2012, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\n\nvar oop = require(\"../../lib/oop\");\nvar BaseFoldMode = require(\"./fold_mode\").FoldMode;\nvar Range = require(\"../../range\").Range;\nvar TokenIterator = require(\"../../token_iterator\").TokenIterator;\n\n\nvar FoldMode = exports.FoldMode = function() {};\n\noop.inherits(FoldMode, BaseFoldMode);\n\n(function() {\n\n    this.foldingStartMarker = /\\b(function|then|do|repeat)\\b|{\\s*$|(\\[=*\\[)/;\n    this.foldingStopMarker = /\\bend\\b|^\\s*}|\\]=*\\]/;\n\n    this.getFoldWidget = function(session, foldStyle, row) {\n        var line = session.getLine(row);\n        var isStart = this.foldingStartMarker.test(line);\n        var isEnd = this.foldingStopMarker.test(line);\n\n        if (isStart && !isEnd) {\n            var match = line.match(this.foldingStartMarker);\n            if (match[1] == \"then\" && /\\belseif\\b/.test(line))\n                return;\n            if (match[1]) {\n                if (session.getTokenAt(row, match.index + 1).type === \"keyword\")\n                    return \"start\";\n            } else if (match[2]) {\n                var type = session.bgTokenizer.getState(row) || \"\";\n                if (type[0] == \"bracketedComment\" || type[0] == \"bracketedString\")\n                    return \"start\";\n            } else {\n                return \"start\";\n            }\n        }\n        if (foldStyle != \"markbeginend\" || !isEnd || isStart && isEnd)\n            return \"\";\n\n        var match = line.match(this.foldingStopMarker);\n        if (match[0] === \"end\") {\n            if (session.getTokenAt(row, match.index + 1).type === \"keyword\")\n                return \"end\";\n        } else if (match[0][0] === \"]\") {\n            var type = session.bgTokenizer.getState(row - 1) || \"\";\n            if (type[0] == \"bracketedComment\" || type[0] == \"bracketedString\")\n                return \"end\";\n        } else\n            return \"end\";\n    };\n\n    this.getFoldWidgetRange = function(session, foldStyle, row) {\n        var line = session.doc.getLine(row);\n        var match = this.foldingStartMarker.exec(line);\n        if (match) {\n            if (match[1])\n                return this.luaBlock(session, row, match.index + 1);\n\n            if (match[2])\n                return session.getCommentFoldRange(row, match.index + 1);\n\n            return this.openingBracketBlock(session, \"{\", row, match.index);\n        }\n\n        var match = this.foldingStopMarker.exec(line);\n        if (match) {\n            if (match[0] === \"end\") {\n                if (session.getTokenAt(row, match.index + 1).type === \"keyword\")\n                    return this.luaBlock(session, row, match.index + 1);\n            }\n\n            if (match[0][0] === \"]\")\n                return session.getCommentFoldRange(row, match.index + 1);\n\n            return this.closingBracketBlock(session, \"}\", row, match.index + match[0].length);\n        }\n    };\n\n    this.luaBlock = function(session, row, column) {\n        var stream = new TokenIterator(session, row, column);\n        var indentKeywords = {\n            \"function\": 1,\n            \"do\": 1,\n            \"then\": 1,\n            \"elseif\": -1,\n            \"end\": -1,\n            \"repeat\": 1,\n            \"until\": -1\n        };\n\n        var token = stream.getCurrentToken();\n        if (!token || token.type != \"keyword\")\n            return;\n\n        var val = token.value;\n        var stack = [val];\n        var dir = indentKeywords[val];\n\n        if (!dir)\n            return;\n\n        var startColumn = dir === -1 ? stream.getCurrentTokenColumn() : session.getLine(row).length;\n        var startRow = row;\n\n        stream.step = dir === -1 ? stream.stepBackward : stream.stepForward;\n        while(token = stream.step()) {\n            if (token.type !== \"keyword\")\n                continue;\n            var level = dir * indentKeywords[token.value];\n\n            if (level > 0) {\n                stack.unshift(token.value);\n            } else if (level <= 0) {\n                stack.shift();\n                if (!stack.length && token.value != \"elseif\")\n                    break;\n                if (level === 0)\n                    stack.unshift(token.value);\n            }\n        }\n\n        var row = stream.getCurrentTokenRow();\n        if (dir === -1)\n            return new Range(row, session.getLine(row).length, startRow, startColumn);\n        else\n            return new Range(startRow, startColumn, row, stream.getCurrentTokenColumn());\n    };\n\n}).call(FoldMode.prototype);\n\n});\n"]}