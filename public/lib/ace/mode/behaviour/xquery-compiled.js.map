{"version":3,"sources":["xquery.js"],"names":[],"mappings":"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","file":"xquery-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2010, Ajax.org B.V.\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\ndefine(function(require, exports, module) {\n\"use strict\";\n\n  var oop = require(\"../../lib/oop\");\n  var Behaviour = require('../behaviour').Behaviour;\n  var CstyleBehaviour = require('./cstyle').CstyleBehaviour;\n  var XmlBehaviour = require(\"../behaviour/xml\").XmlBehaviour;\n  var TokenIterator = require(\"../../token_iterator\").TokenIterator;\n\nfunction hasType(token, type) {\n    var hasType = true;\n    var typeList = token.type.split('.');\n    var needleList = type.split('.');\n    needleList.forEach(function(needle){\n        if (typeList.indexOf(needle) == -1) {\n            hasType = false;\n            return false;\n        }\n    });\n    return hasType;\n}\n \n  var XQueryBehaviour = function () {\n      \n      this.inherit(CstyleBehaviour, [\"braces\", \"parens\", \"string_dquotes\"]); // Get string behaviour\n      this.inherit(XmlBehaviour); // Get xml behaviour\n      \n      this.add(\"autoclosing\", \"insertion\", function (state, action, editor, session, text) {\n        if (text == '>') {\n            var position = editor.getCursorPosition();\n            var iterator = new TokenIterator(session, position.row, position.column);\n            var token = iterator.getCurrentToken();\n            var atCursor = false;\n            var state = JSON.parse(state).pop();\n            if ((token && token.value === '>') || state !== \"StartTag\") return;\n            if (!token || !hasType(token, 'meta.tag') && !(hasType(token, 'text') && token.value.match('/'))){\n                do {\n                    token = iterator.stepBackward();\n                } while (token && (hasType(token, 'string') || hasType(token, 'keyword.operator') || hasType(token, 'entity.attribute-name') || hasType(token, 'text')));\n            } else {\n                atCursor = true;\n            }\n            var previous = iterator.stepBackward();\n            if (!token || !hasType(token, 'meta.tag') || (previous !== null && previous.value.match('/'))) {\n                return\n            }\n            var tag = token.value.substring(1);\n            if (atCursor){\n                var tag = tag.substring(0, position.column - token.start);\n            }\n\n            return {\n               text: '>' + '</' + tag + '>',\n               selection: [1, 1]\n            }\n        }\n    });\n\n  }\n  oop.inherits(XQueryBehaviour, Behaviour);\n\n  exports.XQueryBehaviour = XQueryBehaviour;\n});\n"]}