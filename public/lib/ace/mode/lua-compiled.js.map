{"version":3,"sources":["lua.js"],"names":[],"mappings":"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","file":"lua-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2010, Ajax.org B.V.\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\n\nvar oop = require(\"../lib/oop\");\nvar TextMode = require(\"./text\").Mode;\nvar LuaHighlightRules = require(\"./lua_highlight_rules\").LuaHighlightRules;\nvar LuaFoldMode = require(\"./folding/lua\").FoldMode;\nvar Range = require(\"../range\").Range;\nvar WorkerClient = require(\"../worker/worker_client\").WorkerClient;\n\nvar Mode = function() {\n    this.HighlightRules = LuaHighlightRules;\n    \n    this.foldingRules = new LuaFoldMode();\n    this.$behaviour = this.$defaultBehaviour;\n};\noop.inherits(Mode, TextMode);\n\n(function() {\n   \n    this.lineCommentStart = \"--\";\n    this.blockComment = {start: \"--[\", end: \"]--\"};\n    \n    var indentKeywords = {\n        \"function\": 1,\n        \"then\": 1,\n        \"do\": 1,\n        \"else\": 1,\n        \"elseif\": 1,\n        \"repeat\": 1,\n        \"end\": -1,\n        \"until\": -1\n    };\n    var outdentKeywords = [\n        \"else\",\n        \"elseif\",\n        \"end\",\n        \"until\"\n    ];\n\n    function getNetIndentLevel(tokens) {\n        var level = 0;\n        // Support single-line blocks by decrementing the indent level if\n        // an ending token is found\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            if (token.type == \"keyword\") {\n                if (token.value in indentKeywords) {\n                    level += indentKeywords[token.value];\n                }\n            } else if (token.type == \"paren.lparen\") {\n                level += token.value.length;\n            } else if (token.type == \"paren.rparen\") {\n                level -= token.value.length;\n            }\n        }\n        // Limit the level to +/- 1 since usually users only indent one level\n        // at a time regardless of the logical nesting level\n        if (level < 0) {\n            return -1;\n        } else if (level > 0) {\n            return 1;\n        } else {\n            return 0;\n        }\n    }\n\n    this.getNextLineIndent = function(state, line, tab) {\n        var indent = this.$getIndent(line);\n        var level = 0;\n\n        var tokenizedLine = this.getTokenizer().getLineTokens(line, state);\n        var tokens = tokenizedLine.tokens;\n\n        if (state == \"start\") {\n            level = getNetIndentLevel(tokens);\n        }\n        if (level > 0) {\n            return indent + tab;\n        } else if (level < 0 && indent.substr(indent.length - tab.length) == tab) {\n            // Don't do a next-line outdent if we're going to do a real outdent of this line\n            if (!this.checkOutdent(state, line, \"\\n\")) {\n                return indent.substr(0, indent.length - tab.length);\n            }\n        }\n        return indent;\n    };\n\n    this.checkOutdent = function(state, line, input) {\n        if (input != \"\\n\" && input != \"\\r\" && input != \"\\r\\n\")\n            return false;\n\n        if (line.match(/^\\s*[\\)\\}\\]]$/))\n            return true;\n\n        var tokens = this.getTokenizer().getLineTokens(line.trim(), state).tokens;\n\n        if (!tokens || !tokens.length)\n            return false;\n\n        return (tokens[0].type == \"keyword\" && outdentKeywords.indexOf(tokens[0].value) != -1);\n    };\n\n    this.autoOutdent = function(state, session, row) {\n        var prevLine = session.getLine(row - 1);\n        var prevIndent = this.$getIndent(prevLine).length;\n        var prevTokens = this.getTokenizer().getLineTokens(prevLine, \"start\").tokens;\n        var tabLength = session.getTabString().length;\n        var expectedIndent = prevIndent + tabLength * getNetIndentLevel(prevTokens);\n        var curIndent = this.$getIndent(session.getLine(row)).length;\n        if (curIndent <= expectedIndent) {\n            // User already outdented //\n            return;\n        }\n        session.outdentRows(new Range(row, 0, row + 2, 0));\n    };\n\n    this.createWorker = function(session) {\n        var worker = new WorkerClient([\"ace\"], \"ace/mode/lua_worker\", \"Worker\");\n        worker.attachToDocument(session.getDocument());\n        \n        worker.on(\"annotate\", function(e) {\n            session.setAnnotations(e.data);\n        });\n        \n        worker.on(\"terminate\", function() {\n            session.clearAnnotations();\n        });\n        \n        return worker;\n    };\n\n    this.$id = \"ace/mode/lua\";\n}).call(Mode.prototype);\n\nexports.Mode = Mode;\n});\n\n\n"]}