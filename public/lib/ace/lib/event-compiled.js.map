{"version":3,"sources":["event.js"],"names":[],"mappings":"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","file":"event-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2010, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\n\nvar keys = require(\"./keys\");\nvar useragent = require(\"./useragent\");\n\nvar pressedKeys = null;\nvar ts = 0;\n\nexports.addListener = function(elem, type, callback) {\n    if (elem.addEventListener) {\n        return elem.addEventListener(type, callback, false);\n    }\n    if (elem.attachEvent) {\n        var wrapper = function() {\n            callback.call(elem, window.event);\n        };\n        callback._wrapper = wrapper;\n        elem.attachEvent(\"on\" + type, wrapper);\n    }\n};\n\nexports.removeListener = function(elem, type, callback) {\n    if (elem.removeEventListener) {\n        return elem.removeEventListener(type, callback, false);\n    }\n    if (elem.detachEvent) {\n        elem.detachEvent(\"on\" + type, callback._wrapper || callback);\n    }\n};\n\n/*\n* Prevents propagation and clobbers the default action of the passed event\n*/\nexports.stopEvent = function(e) {\n    exports.stopPropagation(e);\n    exports.preventDefault(e);\n    return false;\n};\n\nexports.stopPropagation = function(e) {\n    if (e.stopPropagation)\n        e.stopPropagation();\n    else\n        e.cancelBubble = true;\n};\n\nexports.preventDefault = function(e) {\n    if (e.preventDefault)\n        e.preventDefault();\n    else\n        e.returnValue = false;\n};\n\n/*\n * @return {Number} 0 for left button, 1 for middle button, 2 for right button\n */\nexports.getButton = function(e) {\n    if (e.type == \"dblclick\")\n        return 0;\n    if (e.type == \"contextmenu\" || (useragent.isMac && (e.ctrlKey && !e.altKey && !e.shiftKey)))\n        return 2;\n\n    // DOM Event\n    if (e.preventDefault) {\n        return e.button;\n    }\n    // old IE\n    else {\n        return {1:0, 2:2, 4:1}[e.button];\n    }\n};\n\nexports.capture = function(el, eventHandler, releaseCaptureHandler) {\n    function onMouseUp(e) {\n        eventHandler && eventHandler(e);\n        releaseCaptureHandler && releaseCaptureHandler(e);\n\n        exports.removeListener(document, \"mousemove\", eventHandler, true);\n        exports.removeListener(document, \"mouseup\", onMouseUp, true);\n        exports.removeListener(document, \"dragstart\", onMouseUp, true);\n    }\n\n    exports.addListener(document, \"mousemove\", eventHandler, true);\n    exports.addListener(document, \"mouseup\", onMouseUp, true);\n    exports.addListener(document, \"dragstart\", onMouseUp, true);\n    \n    return onMouseUp;\n};\n\nexports.addTouchMoveListener = function (el, callback) {\n    if (\"ontouchmove\" in el) {\n        var startx, starty;\n        exports.addListener(el, \"touchstart\", function (e) {\n            var touchObj = e.changedTouches[0];\n            startx = touchObj.clientX;\n            starty = touchObj.clientY;\n        });\n        exports.addListener(el, \"touchmove\", function (e) {\n            var factor = 1,\n            touchObj = e.changedTouches[0];\n\n            e.wheelX = -(touchObj.clientX - startx) / factor;\n            e.wheelY = -(touchObj.clientY - starty) / factor;\n\n            startx = touchObj.clientX;\n            starty = touchObj.clientY;\n\n            callback(e);\n        });\n    } \n};\n\nexports.addMouseWheelListener = function(el, callback) {\n    if (\"onmousewheel\" in el) {\n        exports.addListener(el, \"mousewheel\", function(e) {\n            var factor = 8;\n            if (e.wheelDeltaX !== undefined) {\n                e.wheelX = -e.wheelDeltaX / factor;\n                e.wheelY = -e.wheelDeltaY / factor;\n            } else {\n                e.wheelX = 0;\n                e.wheelY = -e.wheelDelta / factor;\n            }\n            callback(e);\n        });\n    } else if (\"onwheel\" in el) {\n        exports.addListener(el, \"wheel\",  function(e) {\n            var factor = 0.35;\n            switch (e.deltaMode) {\n                case e.DOM_DELTA_PIXEL:\n                    e.wheelX = e.deltaX * factor || 0;\n                    e.wheelY = e.deltaY * factor || 0;\n                    break;\n                case e.DOM_DELTA_LINE:\n                case e.DOM_DELTA_PAGE:\n                    e.wheelX = (e.deltaX || 0) * 5;\n                    e.wheelY = (e.deltaY || 0) * 5;\n                    break;\n            }\n            \n            callback(e);\n        });\n    } else {\n        exports.addListener(el, \"DOMMouseScroll\", function(e) {\n            if (e.axis && e.axis == e.HORIZONTAL_AXIS) {\n                e.wheelX = (e.detail || 0) * 5;\n                e.wheelY = 0;\n            } else {\n                e.wheelX = 0;\n                e.wheelY = (e.detail || 0) * 5;\n            }\n            callback(e);\n        });\n    }\n};\n\nexports.addMultiMouseDownListener = function(elements, timeouts, eventHandler, callbackName) {\n    var clicks = 0;\n    var startX, startY, timer; \n    var eventNames = {\n        2: \"dblclick\",\n        3: \"tripleclick\",\n        4: \"quadclick\"\n    };\n\n    function onMousedown(e) {\n        if (exports.getButton(e) !== 0) {\n            clicks = 0;\n        } else if (e.detail > 1) {\n            clicks++;\n            if (clicks > 4)\n                clicks = 1;\n        } else {\n            clicks = 1;\n        }\n        if (useragent.isIE) {\n            var isNewClick = Math.abs(e.clientX - startX) > 5 || Math.abs(e.clientY - startY) > 5;\n            if (!timer || isNewClick)\n                clicks = 1;\n            if (timer)\n                clearTimeout(timer);\n            timer = setTimeout(function() {timer = null}, timeouts[clicks - 1] || 600);\n\n            if (clicks == 1) {\n                startX = e.clientX;\n                startY = e.clientY;\n            }\n        }\n        \n        e._clicks = clicks;\n\n        eventHandler[callbackName](\"mousedown\", e);\n\n        if (clicks > 4)\n            clicks = 0;\n        else if (clicks > 1)\n            return eventHandler[callbackName](eventNames[clicks], e);\n    }\n    function onDblclick(e) {\n        clicks = 2;\n        if (timer)\n            clearTimeout(timer);\n        timer = setTimeout(function() {timer = null}, timeouts[clicks - 1] || 600);\n        eventHandler[callbackName](\"mousedown\", e);\n        eventHandler[callbackName](eventNames[clicks], e);\n    }\n    if (!Array.isArray(elements))\n        elements = [elements];\n    elements.forEach(function(el) {\n        exports.addListener(el, \"mousedown\", onMousedown);\n        if (useragent.isOldIE)\n            exports.addListener(el, \"dblclick\", onDblclick);\n    });\n};\n\nvar getModifierHash = useragent.isMac && useragent.isOpera && !(\"KeyboardEvent\" in window)\n    ? function(e) {\n        return 0 | (e.metaKey ? 1 : 0) | (e.altKey ? 2 : 0) | (e.shiftKey ? 4 : 0) | (e.ctrlKey ? 8 : 0);\n    }\n    : function(e) {\n        return 0 | (e.ctrlKey ? 1 : 0) | (e.altKey ? 2 : 0) | (e.shiftKey ? 4 : 0) | (e.metaKey ? 8 : 0);\n    };\n\nexports.getModifierString = function(e) {\n    return keys.KEY_MODS[getModifierHash(e)];\n};\n\nfunction normalizeCommandKeys(callback, e, keyCode) {\n    var hashId = getModifierHash(e);\n\n    if (!useragent.isMac && pressedKeys) {\n        if (e.getModifierState && (e.getModifierState(\"OS\") || e.getModifierState(\"Win\")))\n            hashId |= 8;\n        if (pressedKeys.altGr) {\n            if ((3 & hashId) != 3)\n                pressedKeys.altGr = 0;\n            else\n                return;\n        }\n        if (keyCode === 18 || keyCode === 17) {\n            var location = \"location\" in e ? e.location : e.keyLocation;\n            if (keyCode === 17 && location === 1) {\n                if (pressedKeys[keyCode] == 1)\n                    ts = e.timeStamp;\n            } else if (keyCode === 18 && hashId === 3 && location === 2) {\n                var dt = e.timeStamp - ts;\n                if (dt < 50)\n                    pressedKeys.altGr = true;\n            }\n        }\n    }\n    \n    if (keyCode in keys.MODIFIER_KEYS) {\n        keyCode = -1;\n    }\n\n    // keyCode of right command is 93 on mac and 92 on windows.\n    // keyCode of left command key is 91\n    if (hashId & 8 && (keyCode >= 91 && keyCode <= 93)) {\n        keyCode = -1;\n    }\n    \n    if (!hashId && keyCode === 13) {\n        var location = \"location\" in e ? e.location : e.keyLocation;\n        if (location === 3) {\n            callback(e, hashId, -keyCode);\n            if (e.defaultPrevented)\n                return;\n        }\n    }\n    \n    if (useragent.isChromeOS && hashId & 8) {\n        callback(e, hashId, keyCode);\n        if (e.defaultPrevented)\n            return;\n        else\n            hashId &= ~8;\n    }\n\n    // If there is no hashId and the keyCode is not a function key, then\n    // we don't call the callback as we don't handle a command key here\n    // (it's a normal key/character input).\n    if (!hashId && !(keyCode in keys.FUNCTION_KEYS) && !(keyCode in keys.PRINTABLE_KEYS)) {\n        return false;\n    }\n    \n    return callback(e, hashId, keyCode);\n}\n\n\nexports.addCommandKeyListener = function(el, callback) {\n    var addListener = exports.addListener;\n    if (useragent.isOldGecko || (useragent.isOpera && !(\"KeyboardEvent\" in window))) {\n        // Old versions of Gecko aka. Firefox < 4.0 didn't repeat the keydown\n        // event if the user pressed the key for a longer time. Instead, the\n        // keydown event was fired once and later on only the keypress event.\n        // To emulate the 'right' keydown behavior, the keyCode of the initial\n        // keyDown event is stored and in the following keypress events the\n        // stores keyCode is used to emulate a keyDown event.\n        var lastKeyDownKeyCode = null;\n        addListener(el, \"keydown\", function(e) {\n            lastKeyDownKeyCode = e.keyCode;\n        });\n        addListener(el, \"keypress\", function(e) {\n            return normalizeCommandKeys(callback, e, lastKeyDownKeyCode);\n        });\n    } else {\n        var lastDefaultPrevented = null;\n\n        addListener(el, \"keydown\", function(e) {\n            pressedKeys[e.keyCode] = (pressedKeys[e.keyCode] || 0) + 1;\n            var result = normalizeCommandKeys(callback, e, e.keyCode);\n            lastDefaultPrevented = e.defaultPrevented;\n            return result;\n        });\n\n        addListener(el, \"keypress\", function(e) {\n            if (lastDefaultPrevented && (e.ctrlKey || e.altKey || e.shiftKey || e.metaKey)) {\n                exports.stopEvent(e);\n                lastDefaultPrevented = null;\n            }\n        });\n\n        addListener(el, \"keyup\", function(e) {\n            pressedKeys[e.keyCode] = null;\n        });\n\n        if (!pressedKeys) {\n            resetPressedKeys();\n            addListener(window, \"focus\", resetPressedKeys);\n        }\n    }\n};\nfunction resetPressedKeys() {\n    // console.log(\"resetting\")\n    pressedKeys = Object.create(null);\n}\n\nif (typeof window == \"object\" && window.postMessage && !useragent.isOldIE) {\n    var postMessageId = 1;\n    exports.nextTick = function(callback, win) {\n        win = win || window;\n        var messageName = \"zero-timeout-message-\" + postMessageId;\n        exports.addListener(win, \"message\", function listener(e) {\n            if (e.data == messageName) {\n                exports.stopPropagation(e);\n                exports.removeListener(win, \"message\", listener);\n                callback();\n            }\n        });\n        win.postMessage(messageName, \"*\");\n    };\n}\n\n\nexports.nextFrame = typeof window == \"object\" && (window.requestAnimationFrame\n    || window.mozRequestAnimationFrame\n    || window.webkitRequestAnimationFrame\n    || window.msRequestAnimationFrame\n    || window.oRequestAnimationFrame);\n\nif (exports.nextFrame)\n    exports.nextFrame = exports.nextFrame.bind(window);\nelse\n    exports.nextFrame = function(callback) {\n        setTimeout(callback, 17);\n    };\n});\n"]}