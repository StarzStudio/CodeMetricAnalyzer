{"version":3,"sources":["elastic_tabstops_lite.js"],"names":[],"mappings":"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","file":"elastic_tabstops_lite-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2012, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\n\nvar ElasticTabstopsLite = function(editor) {\n    this.$editor = editor;\n    var self = this;\n    var changedRows = [];\n    var recordChanges = false;\n    this.onAfterExec = function() {\n        recordChanges = false;\n        self.processRows(changedRows);\n        changedRows = [];\n    };\n    this.onExec = function() {\n        recordChanges = true;\n    };\n    this.onChange = function(delta) {\n        if (recordChanges) {\n            if (changedRows.indexOf(delta.start.row) == -1)\n                changedRows.push(delta.start.row);\n            if (delta.end.row != delta.start.row)\n                changedRows.push(delta.end.row);\n        }\n    };\n};\n\n(function() {\n    this.processRows = function(rows) {\n        this.$inChange = true;\n        var checkedRows = [];\n\n        for (var r = 0, rowCount = rows.length; r < rowCount; r++) {\n            var row = rows[r];\n\n            if (checkedRows.indexOf(row) > -1)\n                continue;\n\n            var cellWidthObj = this.$findCellWidthsForBlock(row);\n            var cellWidths = this.$setBlockCellWidthsToMax(cellWidthObj.cellWidths);\n            var rowIndex = cellWidthObj.firstRow;\n\n            for (var w = 0, l = cellWidths.length; w < l; w++) {\n                var widths = cellWidths[w];\n                checkedRows.push(rowIndex);\n                this.$adjustRow(rowIndex, widths);\n                rowIndex++;\n            }\n        }\n        this.$inChange = false;\n    };\n\n    this.$findCellWidthsForBlock = function(row) {\n        var cellWidths = [], widths;\n\n        // starting row and backward\n        var rowIter = row;\n        while (rowIter >= 0) {\n            widths = this.$cellWidthsForRow(rowIter);\n            if (widths.length == 0)\n                break;\n\n            cellWidths.unshift(widths);\n            rowIter--;\n        }\n        var firstRow = rowIter + 1;\n\n        // forward (not including starting row)\n        rowIter = row;\n        var numRows = this.$editor.session.getLength();\n\n        while (rowIter < numRows - 1) {\n            rowIter++;\n\n            widths = this.$cellWidthsForRow(rowIter);\n            if (widths.length == 0)\n                break;\n\n            cellWidths.push(widths);\n        }\n\n        return { cellWidths: cellWidths, firstRow: firstRow };\n    };\n\n    this.$cellWidthsForRow = function(row) {\n        var selectionColumns = this.$selectionColumnsForRow(row);\n        // todo: support multicursor\n\n        var tabs = [-1].concat(this.$tabsForRow(row));\n        var widths = tabs.map(function(el) { return 0; } ).slice(1);\n        var line = this.$editor.session.getLine(row);\n\n        for (var i = 0, len = tabs.length - 1; i < len; i++) {\n            var leftEdge = tabs[i]+1;\n            var rightEdge = tabs[i+1];\n\n            var rightmostSelection = this.$rightmostSelectionInCell(selectionColumns, rightEdge);\n            var cell = line.substring(leftEdge, rightEdge);\n            widths[i] = Math.max(cell.replace(/\\s+$/g,'').length, rightmostSelection - leftEdge);\n        }\n\n        return widths;\n    };\n\n    this.$selectionColumnsForRow = function(row) {\n        var selections = [], cursor = this.$editor.getCursorPosition();\n        if (this.$editor.session.getSelection().isEmpty()) {\n            // todo: support multicursor\n            if (row == cursor.row)\n                selections.push(cursor.column);\n        }\n\n        return selections;\n    };\n\n    this.$setBlockCellWidthsToMax = function(cellWidths) {\n        var startingNewBlock = true, blockStartRow, blockEndRow, maxWidth;\n        var columnInfo = this.$izip_longest(cellWidths);\n\n        for (var c = 0, l = columnInfo.length; c < l; c++) {\n            var column = columnInfo[c];\n            if (!column.push) {\n                console.error(column);\n                continue;\n            }\n            // add an extra None to the end so that the end of the column automatically\n            // finishes a block\n            column.push(NaN);\n\n            for (var r = 0, s = column.length; r < s; r++) {\n                var width = column[r];\n                if (startingNewBlock) {\n                    blockStartRow = r;\n                    maxWidth = 0;\n                    startingNewBlock = false;\n                }\n                if (isNaN(width)) {\n                    // block ended\n                    blockEndRow = r;\n\n                    for (var j = blockStartRow; j < blockEndRow; j++) {\n                        cellWidths[j][c] = maxWidth;\n                    }\n                    startingNewBlock = true;\n                }\n\n                maxWidth = Math.max(maxWidth, width);\n            }\n        }\n\n        return cellWidths;\n    };\n\n    this.$rightmostSelectionInCell = function(selectionColumns, cellRightEdge) {\n        var rightmost = 0;\n\n        if (selectionColumns.length) {\n            var lengths = [];\n            for (var s = 0, length = selectionColumns.length; s < length; s++) {\n                if (selectionColumns[s] <= cellRightEdge)\n                    lengths.push(s);\n                else\n                    lengths.push(0);\n            }\n            rightmost = Math.max.apply(Math, lengths);\n        }\n\n        return rightmost;\n    };\n\n    this.$tabsForRow = function(row) {\n        var rowTabs = [], line = this.$editor.session.getLine(row),\n            re = /\\t/g, match;\n\n        while ((match = re.exec(line)) != null) {\n            rowTabs.push(match.index);\n        }\n\n        return rowTabs;\n    };\n\n    this.$adjustRow = function(row, widths) {\n        var rowTabs = this.$tabsForRow(row);\n\n        if (rowTabs.length == 0)\n            return;\n\n        var bias = 0, location = -1;\n\n        // this always only contains two elements, so we're safe in the loop below\n        var expandedSet = this.$izip(widths, rowTabs);\n\n        for (var i = 0, l = expandedSet.length; i < l; i++) {\n            var w = expandedSet[i][0], it = expandedSet[i][1];\n            location += 1 + w;\n            it += bias;\n            var difference = location - it;\n\n            if (difference == 0)\n                continue;\n\n            var partialLine = this.$editor.session.getLine(row).substr(0, it );\n            var strippedPartialLine = partialLine.replace(/\\s*$/g, \"\");\n            var ispaces = partialLine.length - strippedPartialLine.length;\n\n            if (difference > 0) {\n                // put the spaces after the tab and then delete the tab, so any insertion\n                // points behave as expected\n                this.$editor.session.getDocument().insertInLine({row: row, column: it + 1}, Array(difference + 1).join(\" \") + \"\\t\");\n                this.$editor.session.getDocument().removeInLine(row, it, it + 1);\n\n                bias += difference;\n            }\n\n            if (difference < 0 && ispaces >= -difference) {\n                this.$editor.session.getDocument().removeInLine(row, it + difference, it);\n                bias += difference;\n            }\n        }\n    };\n\n    // the is a (naive) Python port--but works for these purposes\n    this.$izip_longest = function(iterables) {\n        if (!iterables[0])\n            return [];\n        var longest = iterables[0].length;\n        var iterablesLength = iterables.length;\n\n        for (var i = 1; i < iterablesLength; i++) {\n            var iLength = iterables[i].length;\n            if (iLength > longest)\n                longest = iLength;\n        }\n\n        var expandedSet = [];\n\n        for (var l = 0; l < longest; l++) {\n            var set = [];\n            for (var i = 0; i < iterablesLength; i++) {\n                if (iterables[i][l] === \"\")\n                    set.push(NaN);\n                else\n                    set.push(iterables[i][l]);\n            }\n\n            expandedSet.push(set);\n        }\n\n\n        return expandedSet;\n    };\n\n    // an even more (naive) Python port\n    this.$izip = function(widths, tabs) {\n        // grab the shorter size\n        var size = widths.length >= tabs.length ? tabs.length : widths.length;\n\n        var expandedSet = [];\n        for (var i = 0; i < size; i++) {\n            var set = [ widths[i], tabs[i] ];\n            expandedSet.push(set);\n        }\n        return expandedSet;\n    };\n\n}).call(ElasticTabstopsLite.prototype);\n\nexports.ElasticTabstopsLite = ElasticTabstopsLite;\n\nvar Editor = require(\"../editor\").Editor;\nrequire(\"../config\").defineOptions(Editor.prototype, \"editor\", {\n    useElasticTabstops: {\n        set: function(val) {\n            if (val) {\n                if (!this.elasticTabstops)\n                    this.elasticTabstops = new ElasticTabstopsLite(this);\n                this.commands.on(\"afterExec\", this.elasticTabstops.onAfterExec);\n                this.commands.on(\"exec\", this.elasticTabstops.onExec);\n                this.on(\"change\", this.elasticTabstops.onChange);\n            } else if (this.elasticTabstops) {\n                this.commands.removeListener(\"afterExec\", this.elasticTabstops.onAfterExec);\n                this.commands.removeListener(\"exec\", this.elasticTabstops.onExec);\n                this.removeListener(\"change\", this.elasticTabstops.onChange);\n            }\n        }\n    }\n});\n\n});"]}