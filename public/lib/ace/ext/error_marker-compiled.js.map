{"version":3,"sources":["error_marker.js"],"names":[],"mappings":"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","file":"error_marker-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2012, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\nvar LineWidgets = require(\"../line_widgets\").LineWidgets;\nvar dom = require(\"../lib/dom\");\nvar Range = require(\"../range\").Range;\n\nfunction binarySearch(array, needle, comparator) {\n    var first = 0;\n    var last = array.length - 1;\n\n    while (first <= last) {\n        var mid = (first + last) >> 1;\n        var c = comparator(needle, array[mid]);\n        if (c > 0)\n            first = mid + 1;\n        else if (c < 0)\n            last = mid - 1;\n        else\n            return mid;\n    }\n\n    // Return the nearest lesser index, \"-1\" means \"0, \"-2\" means \"1\", etc.\n    return -(first + 1);\n}\n\nfunction findAnnotations(session, row, dir) {\n    var annotations = session.getAnnotations().sort(Range.comparePoints);\n    if (!annotations.length)\n        return;\n    \n    var i = binarySearch(annotations, {row: row, column: -1}, Range.comparePoints);\n    if (i < 0)\n        i = -i - 1;\n    \n    if (i >= annotations.length)\n        i = dir > 0 ? 0 : annotations.length - 1;\n    else if (i === 0 && dir < 0)\n        i = annotations.length - 1;\n    \n    var annotation = annotations[i];\n    if (!annotation || !dir)\n        return;\n\n    if (annotation.row === row) {\n        do {\n            annotation = annotations[i += dir];\n        } while (annotation && annotation.row === row);\n        if (!annotation)\n            return annotations.slice();\n    }\n    \n    \n    var matched = [];\n    row = annotation.row;\n    do {\n        matched[dir < 0 ? \"unshift\" : \"push\"](annotation);\n        annotation = annotations[i += dir];\n    } while (annotation && annotation.row == row);\n    return matched.length && matched;\n}\n\nexports.showErrorMarker = function(editor, dir) {\n    var session = editor.session;\n    if (!session.widgetManager) {\n        session.widgetManager = new LineWidgets(session);\n        session.widgetManager.attach(editor);\n    }\n    \n    var pos = editor.getCursorPosition();\n    var row = pos.row;\n    var oldWidget = session.widgetManager.getWidgetsAtRow(row).filter(function(w) {\n        return w.type == \"errorMarker\";\n    })[0];\n    if (oldWidget) {\n        oldWidget.destroy();\n    } else {\n        row -= dir;\n    }\n    var annotations = findAnnotations(session, row, dir);\n    var gutterAnno;\n    if (annotations) {\n        var annotation = annotations[0];\n        pos.column = (annotation.pos && typeof annotation.column != \"number\"\n            ? annotation.pos.sc\n            : annotation.column) || 0;\n        pos.row = annotation.row;\n        gutterAnno = editor.renderer.$gutterLayer.$annotations[pos.row];\n    } else if (oldWidget) {\n        return;\n    } else {\n        gutterAnno = {\n            text: [\"Looks good!\"],\n            className: \"ace_ok\"\n        };\n    }\n    editor.session.unfold(pos.row);\n    editor.selection.moveToPosition(pos);\n    \n    var w = {\n        row: pos.row, \n        fixedWidth: true,\n        coverGutter: true,\n        el: dom.createElement(\"div\"),\n        type: \"errorMarker\"\n    };\n    var el = w.el.appendChild(dom.createElement(\"div\"));\n    var arrow = w.el.appendChild(dom.createElement(\"div\"));\n    arrow.className = \"error_widget_arrow \" + gutterAnno.className;\n    \n    var left = editor.renderer.$cursorLayer\n        .getPixelPosition(pos).left;\n    arrow.style.left = left + editor.renderer.gutterWidth - 5 + \"px\";\n    \n    w.el.className = \"error_widget_wrapper\";\n    el.className = \"error_widget \" + gutterAnno.className;\n    el.innerHTML = gutterAnno.text.join(\"<br>\");\n    \n    el.appendChild(dom.createElement(\"div\"));\n    \n    var kb = function(_, hashId, keyString) {\n        if (hashId === 0 && (keyString === \"esc\" || keyString === \"return\")) {\n            w.destroy();\n            return {command: \"null\"};\n        }\n    };\n    \n    w.destroy = function() {\n        if (editor.$mouseHandler.isMousePressed)\n            return;\n        editor.keyBinding.removeKeyboardHandler(kb);\n        session.widgetManager.removeLineWidget(w);\n        editor.off(\"changeSelection\", w.destroy);\n        editor.off(\"changeSession\", w.destroy);\n        editor.off(\"mouseup\", w.destroy);\n        editor.off(\"change\", w.destroy);\n    };\n    \n    editor.keyBinding.addKeyboardHandler(kb);\n    editor.on(\"changeSelection\", w.destroy);\n    editor.on(\"changeSession\", w.destroy);\n    editor.on(\"mouseup\", w.destroy);\n    editor.on(\"change\", w.destroy);\n    \n    editor.session.widgetManager.addLineWidget(w);\n    \n    w.el.onmousedown = editor.focus.bind(editor);\n    \n    editor.renderer.scrollCursorIntoView(null, 0.5, {bottom: w.el.offsetHeight});\n};\n\n\ndom.importCssString(\"\\\n    .error_widget_wrapper {\\\n        background: inherit;\\\n        color: inherit;\\\n        border:none\\\n    }\\\n    .error_widget {\\\n        border-top: solid 2px;\\\n        border-bottom: solid 2px;\\\n        margin: 5px 0;\\\n        padding: 10px 40px;\\\n        white-space: pre-wrap;\\\n    }\\\n    .error_widget.ace_error, .error_widget_arrow.ace_error{\\\n        border-color: #ff5a5a\\\n    }\\\n    .error_widget.ace_warning, .error_widget_arrow.ace_warning{\\\n        border-color: #F1D817\\\n    }\\\n    .error_widget.ace_info, .error_widget_arrow.ace_info{\\\n        border-color: #5a5a5a\\\n    }\\\n    .error_widget.ace_ok, .error_widget_arrow.ace_ok{\\\n        border-color: #5aaa5a\\\n    }\\\n    .error_widget_arrow {\\\n        position: absolute;\\\n        border: solid 5px;\\\n        border-top-color: transparent!important;\\\n        border-right-color: transparent!important;\\\n        border-left-color: transparent!important;\\\n        top: -5px;\\\n    }\\\n\", \"\");\n\n});"]}