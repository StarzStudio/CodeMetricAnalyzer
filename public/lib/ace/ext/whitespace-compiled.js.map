{"version":3,"sources":["whitespace.js"],"names":[],"mappings":"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","file":"whitespace-compiled.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n * Distributed under the BSD license:\n *\n * Copyright (c) 2010, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * ***** END LICENSE BLOCK ***** */\n\ndefine(function(require, exports, module) {\n\"use strict\";\n\nvar lang = require(\"../lib/lang\");\n\n// based on http://www.freehackers.org/Indent_Finder\nexports.$detectIndentation = function(lines, fallback) {\n    var stats = [];\n    var changes = [];\n    var tabIndents = 0;\n    var prevSpaces = 0;\n    var max = Math.min(lines.length, 1000);\n    for (var i = 0; i < max; i++) {\n        var line = lines[i];\n        // ignore empty and comment lines\n        if (!/^\\s*[^*+\\-\\s]/.test(line))\n            continue;\n\n        if (line[0] == \"\\t\") {\n            tabIndents++;\n            prevSpaces = -Number.MAX_VALUE;\n        } else {\n            var spaces = line.match(/^ */)[0].length;\n            if (spaces && line[spaces] != \"\\t\") {\n                var diff = spaces - prevSpaces;\n                if (diff > 0 && !(prevSpaces%diff) && !(spaces%diff))\n                    changes[diff] = (changes[diff] || 0) + 1;\n    \n                stats[spaces] = (stats[spaces] || 0) + 1;\n            }\n            prevSpaces = spaces;\n        }\n        // ignore lines ending with backslash\n        while (i < max && line[line.length - 1] == \"\\\\\")\n            line = lines[i++];\n    }\n    \n    function getScore(indent) {\n        var score = 0;\n        for (var i = indent; i < stats.length; i += indent)\n            score += stats[i] || 0;\n        return score;\n    }\n\n    var changesTotal = changes.reduce(function(a,b){return a+b}, 0);\n\n    var first = {score: 0, length: 0};\n    var spaceIndents = 0;\n    for (var i = 1; i < 12; i++) {\n        var score = getScore(i);\n        if (i == 1) {\n            spaceIndents = score;\n            score = stats[1] ? 0.9 : 0.8;\n            if (!stats.length)\n                score = 0;\n        } else\n            score /= spaceIndents;\n\n        if (changes[i])\n            score += changes[i] / changesTotal;\n\n        if (score > first.score)\n            first = {score: score, length: i};\n    }\n\n    if (first.score && first.score > 1.4)\n        var tabLength = first.length;\n\n    if (tabIndents > spaceIndents + 1) {\n        if (tabLength == 1 || spaceIndents < tabIndents / 4 || first.score < 1.8)\n            tabLength = undefined;\n        return {ch: \"\\t\", length: tabLength};\n    }\n    if (spaceIndents > tabIndents + 1)\n        return {ch: \" \", length: tabLength};\n};\n\nexports.detectIndentation = function(session) {\n    var lines = session.getLines(0, 1000);\n    var indent = exports.$detectIndentation(lines) || {};\n\n    if (indent.ch)\n        session.setUseSoftTabs(indent.ch == \" \");\n\n    if (indent.length)\n        session.setTabSize(indent.length);\n    return indent;\n};\n\nexports.trimTrailingSpace = function(session, trimEmpty) {\n    var doc = session.getDocument();\n    var lines = doc.getAllLines();\n    \n    var min = trimEmpty ? -1 : 0;\n\n    for (var i = 0, l=lines.length; i < l; i++) {\n        var line = lines[i];\n        var index = line.search(/\\s+$/);\n\n        if (index > min)\n            doc.removeInLine(i, index, line.length);\n    }\n};\n\nexports.convertIndentation = function(session, ch, len) {\n    var oldCh = session.getTabString()[0];\n    var oldLen = session.getTabSize();\n    if (!len) len = oldLen;\n    if (!ch) ch = oldCh;\n\n    var tab = ch == \"\\t\" ? ch: lang.stringRepeat(ch, len);\n\n    var doc = session.doc;\n    var lines = doc.getAllLines();\n\n    var cache = {};\n    var spaceCache = {};\n    for (var i = 0, l=lines.length; i < l; i++) {\n        var line = lines[i];\n        var match = line.match(/^\\s*/)[0];\n        if (match) {\n            var w = session.$getStringScreenWidth(match)[0];\n            var tabCount = Math.floor(w/oldLen);\n            var reminder = w%oldLen;\n            var toInsert = cache[tabCount] || (cache[tabCount] = lang.stringRepeat(tab, tabCount));\n            toInsert += spaceCache[reminder] || (spaceCache[reminder] = lang.stringRepeat(\" \", reminder));\n\n            if (toInsert != match) {\n                doc.removeInLine(i, 0, match.length);\n                doc.insertInLine({row: i, column: 0}, toInsert);\n            }\n        }\n    }\n    session.setTabSize(len);\n    session.setUseSoftTabs(ch == \" \");\n};\n\nexports.$parseStringArg = function(text) {\n    var indent = {};\n    if (/t/.test(text))\n        indent.ch = \"\\t\";\n    else if (/s/.test(text))\n        indent.ch = \" \";\n    var m = text.match(/\\d+/);\n    if (m)\n        indent.length = parseInt(m[0], 10);\n    return indent;\n};\n\nexports.$parseArg = function(arg) {\n    if (!arg)\n        return {};\n    if (typeof arg == \"string\")\n        return exports.$parseStringArg(arg);\n    if (typeof arg.text == \"string\")\n        return exports.$parseStringArg(arg.text);\n    return arg;\n};\n\nexports.commands = [{\n    name: \"detectIndentation\",\n    exec: function(editor) {\n        exports.detectIndentation(editor.session);\n        // todo show message?\n    }\n}, {\n    name: \"trimTrailingSpace\",\n    exec: function(editor) {\n        exports.trimTrailingSpace(editor.session);\n    }\n}, {\n    name: \"convertIndentation\",\n    exec: function(editor, arg) {\n        var indent = exports.$parseArg(arg);\n        exports.convertIndentation(editor.session, indent.ch, indent.length);\n    }\n}, {\n    name: \"setIndentation\",\n    exec: function(editor, arg) {\n        var indent = exports.$parseArg(arg);\n        indent.length && editor.session.setTabSize(indent.length);\n        indent.ch && editor.session.setUseSoftTabs(indent.ch == \" \");\n    }\n}];\n\n});\n"]}