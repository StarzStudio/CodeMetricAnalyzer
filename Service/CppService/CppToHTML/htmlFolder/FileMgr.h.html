<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>FileMgr.h</title>
</head>
<body>
    <div>#ifndef&nbspFILEMGR_H<br>#define&nbspFILEMGR_H<br><br>/////////////////////////////////////////////////////////////////////<br>//&nbspFileMgr.h&nbsp-&nbsprecursively&nbspgo&nbspthrough&nbspall&nbspthe&nbspfiles&nbspin&nbspa&nbspdir&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp//<br>//&nbspver&nbsp1.2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp//<br>//&nbspplatform:&nbspWin&nbsp10&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp//<br>//&nbspXing&nbspZhou,&nbspwork.xingzhou@gmail.com,&nbspSyracuse&nbspUniversity&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp//<br>//&nbspApplication:&nbspMEAN&nbspstack&nbspusing&nbspC++&nbspto&nbspanalyze&nbspcode&nbspmetrics&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp//<br>/////////////////////////////////////////////////////////////////////<br>/*<br>*&nbspPackage&nbspOperations:<br>*&nbsp-------------------<br>*&nbspThis&nbsppackage&nbspprovides&nbspa&nbspclass,&nbspFileMgr,&nbspand&nbspobject&nbspfactory&nbspfunction,<br>*&nbspCreate().&nbsp&nbspIt's&nbspmission&nbspis&nbspto&nbspsearch&nbspthe&nbspdirectory&nbsptree,&nbsprooted&nbspat<br>*&nbspa&nbspspecified&nbsppath,&nbsplooking&nbspfor&nbspfiles&nbspthat&nbspmatch&nbspa&nbspset&nbspof&nbspspecified<br>*&nbsppatterns.<br>*<br>*&nbspIt&nbspprovides&nbspvirtual&nbspfunctions&nbspfile(...),&nbspdir(...),&nbspand&nbspdone(),&nbspwhich<br>*&nbspan&nbspapplication&nbspcan&nbspoverride&nbspto&nbspprovide&nbspapplication&nbspspecific&nbspprocessing<br>*&nbspfor&nbspthe&nbspevents:&nbspfile&nbspfound,&nbspdirectory&nbspfound,&nbspand&nbspfinished&nbspprocessing.<br>*<br>*&nbspThe&nbsppackage&nbspalso&nbspprovides&nbspinterface&nbsphooks&nbspthat&nbspserve&nbspthe&nbspsame&nbsppurpose<br>*&nbspbut&nbspallow&nbspmultiple&nbspreceivers&nbspfor&nbspthose&nbspevents.<br>*<br>*&nbspRequired&nbspFiles:<br>*&nbsp---------------<br>*&nbsp&nbsp&nbspFileMgr.h,&nbspFileMgr.cpp,&nbspIFileMgr.h,&nbsp<br>*&nbsp&nbsp&nbspFileSystem(Linux).h,&nbspFileSystem(Linux).cpp<br>*<br>*<br>*&nbspMaintenance&nbspHistory:<br>*&nbsp--------------------<br>*&nbspver&nbsp3.0&nbsp:&nbsp24&nbspApr&nbsp2017<br>*&nbsp-&nbspmanage&nbspthe&nbsplinux&nbspversion:&nbsp<br>*&nbsp&nbsp&nbsp-&nbspshall&nbspadd&nbspa&nbsp'/'&nbspafter&nbspeach&nbspdir&nbspwhen&nbsptraverse&nbspfor&nbsplinux<br>*&nbsp&nbsp&nbsp&nbsp&nbspin&nbspwindows,&nbspadd&nbsp'\\'<br>*/<br><br>#include&nbsp&quotIFileMgr.h&quot<br>#include&nbsp&quot../FileSystem/FileSystem.h&quot<br><br>namespace&nbspFileManager<br>{<br>class&nbspFileMgr&nbsp:&nbsppublic&nbspIFileMgr<br>{<br>public:<br>&nbsp&nbspusing&nbsppatterns&nbsp=&nbspstd::vector&ltstd::string&gt;<br>&nbsp&nbspusing&nbspFile&nbsp=&nbspstd::string;<br>&nbsp&nbspusing&nbspDir&nbsp=&nbspstd::string;<br>&nbsp&nbspusing&nbspfileSubscribers&nbsp=&nbspstd::vector&ltIFileEventHandler&nbsp*&gt;<br>&nbsp&nbspusing&nbspdirSubscribers&nbsp=&nbspstd::vector&ltIDirEventHandler&nbsp*&gt;<br>&nbsp&nbspusing&nbspdoneSubscribers&nbsp=&nbspstd::vector&ltIDoneEventHandler&nbsp*&gt;<br><br>&nbsp&nbspvirtual&nbsp~FileMgr()&nbsp{}<br><br>&nbsp&nbsp//----&lt&nbspset&nbspdefault&nbspfile&nbsppattern&nbsp&gt-------------------------------<br><br>&nbsp&nbspFileMgr(const&nbspstd::string&nbsp&amppath)&nbsp:&nbsppath_(path)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsppatterns_.push_back(&quot*.*&quot);<br>&nbsp&nbsp&nbsp&nbsppInstance_&nbsp=&nbspthis;<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspreturn&nbspinstance&nbspof&nbspFileMgr&nbsp&gt-----------------------------<br><br>&nbsp&nbspstatic&nbspIFileMgr&nbsp*getInstance()<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspreturn&nbsppInstance_;<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspadd&nbspfile&nbsppattern,&nbspremoving&nbspdefault&nbspon&nbspfirst&nbspcall&nbsp&gt-------<br><br>&nbsp&nbspvoid&nbspaddPattern(const&nbspstd::string&nbsp&amppatt)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspif&nbsp(patterns_.size()&nbsp==&nbsp1&nbsp&amp&amp&nbsppatterns_[0]&nbsp==&nbsp&quot*.*&quot)<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppatterns_.pop_back();<br>&nbsp&nbsp&nbsp&nbsppatterns_.push_back(patt);<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspapplications&nbspcan&nbspoverload&nbspthis&nbspor&nbspreg&nbspfor&nbspfileEvt&nbsp&gt------<br><br>&nbsp&nbspvirtual&nbspvoid&nbspfile(const&nbspFile&nbsp&ampf)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp++numFilesProcessed;<br>&nbsp&nbsp&nbsp&nbspfor&nbsp(auto&nbsppEvtHandler&nbsp:&nbspfileSubscribers_)<br>&nbsp&nbsp&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppEvtHandler-&gtexecute(f);<br>&nbsp&nbsp&nbsp&nbsp}<br>&nbsp&nbsp&nbsp&nbspstd::cout&nbsp&lt&lt&nbsp&quot&nbsp&nbsptraverse&nbspfile:&nbsp&quot&nbsp&lt&lt&nbspf.c_str()&nbsp&lt&lt&nbspstd::endl;<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspapplications&nbspcan&nbspoverload&nbspthis&nbspor&nbspreg&nbspfor&nbspdirEvt&nbsp&gt-------<br><br>&nbsp&nbspvirtual&nbspvoid&nbspdir(const&nbspDir&nbsp&ampfpath)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspfor&nbsp(auto&nbsppEvtHandler&nbsp:&nbspdirSubscribers_)<br>&nbsp&nbsp&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppEvtHandler-&gtexecute(fpath);<br>&nbsp&nbsp&nbsp&nbsp}<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspapplications&nbspcan&nbspoverload&nbspthis&nbspor&nbspreg&nbspfor&nbspdoneEvt&nbsp&gt------<br><br>&nbsp&nbspvirtual&nbspvoid&nbspdone()<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspfor&nbsp(auto&nbsppEvtHandler&nbsp:&nbspdoneSubscribers_)<br>&nbsp&nbsp&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppEvtHandler-&gtexecute(numFilesProcessed);<br>&nbsp&nbsp&nbsp&nbsp}<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspstart&nbspsearch&nbspon&nbsppreviously&nbspspecified&nbsppath&nbsp&gt--------------<br><br>&nbsp&nbspvoid&nbspsearch()<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspfind(path_);<br>&nbsp&nbsp&nbsp&nbspdone();<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspsearch&nbspcurrent&nbsppath&nbspincluding&nbspsubdirectories&nbsp&gt-----------<br><br>&nbsp&nbspvoid&nbspfind(const&nbspstd::string&nbsp&amppath)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp&nbspstd::cout&nbsp&lt&lt&nbsp&quotfile&nbspmanager&nbspis&nbspsearch&nbsprelative&nbsppath:&nbsp&quot&nbsp&lt&lt&nbsppath.c_str()&nbsp&lt&lt&nbspstd::endl;<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstd::cout&nbsp&lt&lt&nbsp&quotFilemanager&nbspcurrent&nbsppath:&nbsp&quot&nbsp&lt&lt&nbspFileSystem::Directory::getCurrentDirectory().c_str()&nbsp&lt&lt&nbspstd::endl;<br>&nbsp&nbsp&nbsp&nbspstd::string&nbspfpath&nbsp=&nbspFileSystem::Path::getFullFileSpec(path);<br>&nbsp&nbsp&nbsp&nbspstd::cout&nbsp&lt&lt&nbsp&quotfile&nbspmanager&nbspis&nbspsearch&nbsppath:&nbsp&quot&nbsp&lt&lt&nbspfpath.c_str()&nbsp&lt&lt&nbspstd::endl;<br>&nbsp&nbsp&nbsp&nbspdir(fpath);<br>&nbsp&nbsp&nbsp&nbspfor&nbsp(auto&nbsppatt&nbsp:&nbsppatterns_)<br>&nbsp&nbsp&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstd::vector&ltstd::string&gt&nbspfiles&nbsp=&nbspFileSystem::Directory::getFiles(fpath,&nbsppatt);<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor&nbsp(auto&nbspf&nbsp:&nbspfiles)<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFile&nbsp_file&nbsp=&nbspFileSystem::Path::fileSpec(fpath,&nbspf);<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfile(_file);<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}<br>&nbsp&nbsp&nbsp&nbsp}<br>&nbsp&nbsp&nbsp&nbspstd::vector&ltstd::string&gt&nbspdirs&nbsp=&nbspFileSystem::Directory::getDirectories(fpath);<br>&nbsp&nbsp&nbsp&nbspfor&nbsp(auto&nbspd&nbsp:&nbspdirs)<br>&nbsp&nbsp&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp(d&nbsp==&nbsp&quot.&quot&nbsp||&nbspd&nbsp==&nbsp&quot..&quot)<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcontinue;<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstd::string&nbspdpath&nbsp=&nbspfpath&nbsp+&nbsp&quot/&quot&nbsp+&nbspd;<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfind(dpath);<br>&nbsp&nbsp&nbsp&nbsp}<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspapplications&nbspuse&nbspthis&nbspto&nbspregister&nbspfor&nbspnotification&nbsp&gt-----<br><br>&nbsp&nbspvoid&nbspregForFiles(IFileEventHandler&nbsp*pHandler)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspfileSubscribers_.push_back(pHandler);<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspapplications&nbspuse&nbspthis&nbspto&nbspregister&nbspfor&nbspnotification&nbsp&gt-----<br><br>&nbsp&nbspvoid&nbspregForDirs(IDirEventHandler&nbsp*pHandler)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspdirSubscribers_.push_back(pHandler);<br>&nbsp&nbsp}<br>&nbsp&nbsp//----&lt&nbspapplications&nbspuse&nbspthis&nbspto&nbspregister&nbspfor&nbspnotification&nbsp&gt-----<br><br>&nbsp&nbspvoid&nbspregForDone(IDoneEventHandler&nbsp*pHandler)<br>&nbsp&nbsp{<br>&nbsp&nbsp&nbsp&nbspdoneSubscribers_.push_back(pHandler);<br>&nbsp&nbsp}<br><br>private:<br>&nbsp&nbspstd::string&nbsppath_;<br>&nbsp&nbsppatterns&nbsppatterns_;<br>&nbsp&nbspsize_t&nbspnumFilesProcessed&nbsp=&nbsp0;<br>&nbsp&nbspfileSubscribers&nbspfileSubscribers_;<br>&nbsp&nbspdirSubscribers&nbspdirSubscribers_;<br>&nbsp&nbspdoneSubscribers&nbspdoneSubscribers_;<br>&nbsp&nbspstatic&nbspIFileMgr&nbsp*pInstance_;<br>};<br><br>struct&nbspFileMgrFactory<br>{<br>&nbsp&nbspstatic&nbspIFileMgr&nbsp*create(const&nbspstd::string&nbsp&amppath);<br>};<br><br>inline&nbspIFileMgr&nbsp*FileMgrFactory::create(const&nbspstd::string&nbsp&amppath)<br>{<br>&nbsp&nbspreturn&nbspnew&nbspFileMgr(path);<br>}<br>}<br>#endif<br></div>
</body>
</html>
